@use 'sass:math';
@use 'print/mixins' as tp;
@use 'print/variables' as *;

/* typography */
h1, h2, h3, h4 {
  bookmark-label: none;

  &[id] { bookmark-label: content(); }

  ._default_layout &[id] { bookmark-label: attr(data-heading) ' ' content(); }
}

h1 {
  @include tp.baselined_text($font_size_h1, 1.5);

  page-break-before: right;
  text-transform: uppercase;
}

h2 {
  @include tp.baselined_text($font_size_h2);

  column-break-before: always;
  text-transform: uppercase;
}

h3 {
  @include tp.baselined_text($font_size_h3);

  + *,
  + aside + * {
    column-break-before: avoid;
    page-break-before: avoid;
  }
}

h4 {
  @include tp.baselined_text($font_size_h4);

  + *,
  + aside + * {
    column-break-before: avoid;
    page-break-before: avoid;
  }
}

._show_heading_numbers [data-heading]::before {
  content: attr(data-heading) ' ';
}

p, blockquote, figcaption, .text {
  @include tp.baselined_text($font_size);

  margin-bottom: $half;
}

blockquote footer { text-align: right; }

img {
  display: block;
  max-width: 100%;
  margin: 0 0 $half;
}

/* lists */
dl, ol, ul {
  @include tp.baselined_text($font_size);

  margin-bottom: $half;

  &._list_upper_roman {
    counter-reset: _list_upper_roman;
    list-style-type: none;
    padding: 0;

    > li,
    > dt {
      &::before {
        counter-increment: _list_upper_roman;
        content: counter(_list_upper_roman, upper-roman) ' â€“ ';
        font-weight: bold;
      }
    }
  }
}

dl {
  margin: 0 0 $half;

  > dt {
    float: left;

    &::after {
      content: ': ';
      white-space: pre;
    }
  }

  > dd {
    margin: 0 0 $half;

    &:last-child { margin-bottom: 0; }
  }
}

ol, ul { padding-left: 1.5em; }

/* tables */
table {
  @include tp.baselined_text($font_size);

  border: 1pt solid $color_dark;
  border-top: 0;
  margin: 0 0 ($half - 2pt);
  width: 100%;

  > caption {
    background: $color_gray;
    border: 1pt solid $color_dark;
    border-bottom: 0;
    font-weight: bold;
    text-align: left;
  }

  > thead,
  > tbody > tr > th,
  > tfoot {
    font-style: italic;
  }

  > caption,
  th,
  td {
    padding: 0 0.5em;
  }

  &._borderless {
    border: 0;
    margin-bottom: $half;

    > caption { border: 0; }
  }

  &._striped {
    caption {
      background: #ddd;
    }

    thead {
      background: $color_white;
    }

    tbody {
      background: $color_white;

      > tr:nth-child(odd) {
        background: $color_light;
      }
    }
  }

  &._army_list {
    @include tp.baselined_text($font_size_small);

    margin-bottom: 3pt;
    page-break-before: avoid;

    > caption {
      background: none;
      text-align: center;
      text-transform: uppercase;
    }

    > thead {
      border-bottom: 1px solid $color_dark;

      > tr {
        &:last-child > th { border-bottom: 1pt solid $color_dark; }

        > th {
          font-style: normal;
          text-transform: uppercase;
        }
        > td { text-align: center; }
      }
    }

    > tbody {
      td.table-container {
        padding-top: 3pt;
      }

      > tr._striped {
        background: $color_light;
      }
    }

    ul {
      font: inherit;
      line-height: 1.25;
      list-style: none;
      margin: 0;
      padding: 0;

      > li:not(:last-child) { margin-bottom: 3pt; }
    }
  }
}

/* classes */
#abbreviations,
.design_concept,
.example_of_play,
.short_story,
.special_rule {
  background: $color_light;
  border: 1pt solid $color_dark;
  margin-bottom: ($half - 2pt);
  padding: 6pt 1em;
  page-break-inside: avoid;

  header,
  h1, .h1,
  h2, .h2,
  h3, .h3,
  h4, .h4,
  h5, .h5,
  h6, .h6 {
    @include tp.baselined_text($font_size_h3);

    font-style: italic;
    font-weight: bold;
    margin: 0 0 $half;
    text-align: center;

    &::before {
      display: block;
      font-style: normal;
      text-transform: uppercase;
    }
  }

  > div  > :last-child {
    &, &.table-responsive > table {
      margin-bottom: 0;
    }
  }
}
.design_concept header::before { content: 'Design Concept'; }
.example_of_play header::before { content: 'Example of Play'; }
.short_story {
  header {
    font-style: normal;
    text-transform: uppercase;
  }

  > div { font-style: italic; }
}
.special_rule {
  h1, .h1,
  h2, .h2,
  h3, .h3,
  h4, .h4,
  h5, .h5,
  h6, .h6 {
    &::before { content: 'Special Rule'; }
  }
}

aside.faq {
  @include tp.baselined_text($font_size_small);

  height: 0;

  &._float_footnote > div { float: footnote; }

  > div {
    float: prince-column-footnote;
    page-break-inside: avoid;

    &::footnote-call { content: none; }

    > h4,
    > div > dl {
      font-style: normal;
      margin-bottom: 0;
      text-align: left;

      &, * {
        font: inherit;
        line-height: inherit;
        margin-bottom: 0;
      }
    }

    > h4,
    > div > dl > dt,
    > div > dl > dt + dd {
      position: relative;

      &::before {
        content: attr(data-footnote);
        left: -1.25em;
        position: absolute;
        text-align: right;
        width: 1em;
      }
    }

    > div > dl {
      > dt {
        font-weight: normal;
        float: none;

        &::before {
          content: 'Q: ';
        }

        &::after {
          content: none;
        }

        + dd::before {
          content: 'A: ';
        }
      }

      > dd {
        margin-bottom: 0;
      }
    }
  }
}

[data-footnote]::after {
  content: ' ' attr(data-footnote);
  font-size: 6pt;
  font-weight: normal;
  line-height: 0;
  vertical-align: super;
}

.datasheet {
  display: table;
  margin-bottom: 3pt;
  width: 100%;

  .unit {
    display: table-row;
    width: 91.875em;

    &:first-child {
      .stats > *::before,
      .weapon:first-child > .weapon_line:first-child > *::before,
      .notes::before {
        background: $color_white;
        border-bottom: 1pt solid $color_dark;
      }

      .notes::before {
        content: 'Notes';
        display: block;
        font-weight: bold;
        font-style: normal;
        margin: 0 -0.5em;
        padding: 0 0.5em;
        text-transform: uppercase;
      }
    }

    &:nth-child(even) { background: $color_white; }

    .stats, .weapons { width: auto; }

    .notes {
      clear: none;
      float: left;
      font-style: italic;

      > :first-child::before { content: none; }
    }
  }

  .type { width: 4em; }
  .speed, .range { width: 5em; }
  .armour { width: 6em; }
  .cc, .ff { width: 3em; }
}

.unit {
  @include tp.clearfix();
  @include tp.baselined_text($font_size_small);

  background: $color_light;
  page-break-inside: avoid;

  &:first-child {
    .stats,
    .weapon:first-child > .weapon_line:first-child {
      > *::before {
        display: block;
        font-weight: bold;
        font-style: normal;
        margin: 0 -0.5em;
        padding: 0 0.5em;
        text-transform: uppercase;
      }
    }

    .stats {
      .name::before { content: 'Name'; }
      .type::before { content: 'Type'; }
      .speed::before { content: 'Speed'; }
      .armour::before { content: 'Armour'; }
      .cc::before { content: 'CC'; }
      .ff::before { content: 'FF'; }
    }

    .weapon:first-child > .weapon_line:first-child {
      .name::before { content: 'Weapons'; }
      .range::before { content: 'Range'; }
      .firepower::before { content: 'Firepower'; }
    }
  }

  .stats,
  .weapons {
    display: table;
    float: left;
    width: 49.999%;
  }
  .stats > *,
  .weapon_line > * {
    display: table-cell;
    padding: 0 0.5em;
    text-align: center;
  }

  .weapon { display: table-row-group; }
  .weapon_line { display: table-row; }

  .notes {
    padding: 0 0.5em;

    > .special_rules {
      > li:last-child::after { content: '.'; }
    }

    > :first-child::before {
      content: 'Notes: ';
      font-style: normal;
      font-weight: bold;
      text-transform: uppercase;
    }

    * { display: inline; }
  }

  .special_rules {
    display: inline;
    padding: 0;

    > li {
      display: inline;

      &:not(:last-child)::after { content: ', '; }
    }
  }

  .name, .firepower { text-align: left; }

  .firepower > :first-child:not(:last-child)::after { content: ', '; }

  .name.boolean { text-align: right; }

  * {
    font: inherit;
    line-height: inherit;
    margin-bottom: 0;
  }
}

/* IDs */
#examples_of_formations {
  figcaption {
    background: $color_black;
    color: $color_white;
    font-style: italic;
    font-weight: bold;
    max-width: 351px;
    text-align: center;
  }

  figcaption, img {
    border: 1pt solid $color_dark;
    margin: 0 auto;
  }
  img {
    border-top-width: 0;
    display: block;
  }
}

#example_initiatve_values,
#needing_7_to_hit {
  border: 0;
  margin: 0 auto;
  width: auto;

  > thead { font-style: normal; }
}

#examples_of_terrain {
  figure {
    display: table;
    margin: 0 0 $half;

    + figure { margin: 0; }
  }

  img,
  figcaption {
    display: table-cell;
    margin: 0;
    vertical-align: middle;
  }

  #hull_down_example {
    margin-right: 1em;
    width: 408px;
  }

  #partial_cover_example {
    margin-left: 1em;
    width: 408px;
  }
}

#weapon_fire_arcs {
  border: 1pt solid $color_dark;
  float: right;
  margin: 0;

  ~ p {
    margin-right: 395px;
    padding-right: 1em;
  }
}

.barrage_table {
  td, th { text-align: center; }
}

#abbreviations {
  @include tp.clearfix();

  > div > dl {
    float: left;
    margin-bottom: 0;
    width: 32%;

    > dd { margin: 0; }

    + dl {
      margin-left: 2%;

      + dl {
        float: right;
        margin: 0;
      }
    }
  }
}
